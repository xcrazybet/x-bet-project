<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-BET Admin Panel</title>
    <style>
        :root {
            --primary: #1a1f36;
            --secondary: #252b42;
            --accent: #00d4aa;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #2ecc71;
            --text: #e0e0e0;
            --text-muted: #a0a0a0;
            --border: #2d3748;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0f1419;
            color: var(--text);
            line-height: 1.6;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background-color: var(--primary);
            padding: 0;
            border-right: 1px solid var(--border);
        }
        
        .logo {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border);
        }
        
        .logo h1 {
            font-size: 24px;
            color: var(--accent);
            font-weight: 700;
        }
        
        .nav-links {
            list-style: none;
            padding: 20px 0;
        }
        
        .nav-links li {
            padding: 15px 30px;
            border-left: 4px solid transparent;
            transition: all 0.3s;
        }
        
        .nav-links li.active {
            border-left-color: var(--accent);
            background-color: rgba(0, 212, 170, 0.1);
        }
        
        .nav-links a {
            color: var(--text);
            text-decoration: none;
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        
        .nav-links i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }
        
        .main-content {
            flex: 1;
            padding: 0;
            overflow-y: auto;
        }
        
        .top-header {
            background: var(--secondary);
            padding: 20px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h2 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .content-area {
            padding: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: var(--secondary);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--accent);
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent);
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background-color: var(--secondary);
            padding: 15px;
            border-radius: 8px;
        }
        
        .search-box {
            background-color: var(--primary);
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 10px 15px;
            color: var(--text);
            width: 300px;
        }
        
        .users-table {
            background-color: var(--secondary);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .table-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 150px;
            padding: 15px 20px;
            background-color: var(--primary);
            font-weight: 600;
            border-bottom: 1px solid var(--border);
        }
        
        .user-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 150px;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }
        
        .user-row:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }
        
        .user-info-col {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
        }
        
        .user-email {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--accent);
            color: var(--primary);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            z-index: 1100;
        }
        
        .notification.success {
            background-color: var(--success);
        }
        
        .notification.error {
            background-color: var(--danger);
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-active {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        .status-inactive {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger);
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>X-BET ADMIN</h1>
            </div>
            <ul class="nav-links">
                <li class="active"><a href="#"><i>üìä</i> Dashboard</a></li>
                <li><a href="#"><i>üë•</i> User Management</a></li>
                <li><a href="#"><i>üí≥</i> Transactions</a></li>
                <li><a href="#"><i>‚è≥</i> Pending Withdrawals</a></li>
                <li><a href="#"><i>üìà</i> Analytics</a></li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="top-header">
                <div class="header">
                    <h2>User Management Dashboard</h2>
                </div>
                <div style="color: var(--success); font-weight: 600;">
                    ‚óè Connected to Firebase
                </div>
            </div>
            
            <div class="content-area">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Users</h3>
                        <div class="value" id="total-users">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>System Balance</h3>
                        <div class="value">$13,999,999.00</div>
                    </div>
                    <div class="stat-card">
                        <h3>Active Today</h3>
                        <div class="value" id="active-users">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending Withdrawals</h3>
                        <div class="value">$0.00</div>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="controls">
                    <input type="text" class="search-box" placeholder="Search users by email or name..." id="search-users">
                    <div>
                        <button class="btn btn-primary" id="refresh-users">Refresh Users</button>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="users-table">
                    <div class="table-header">
                        <div>User Information</div>
                        <div>Balance</div>
                        <div>Profit</div>
                        <div>Status</div>
                        <div>Registered</div>
                        <div>Actions</div>
                    </div>
                    
                    <div id="users-container">
                        <div class="loading" id="loading-message">
                            Connecting to your Firebase database...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ YOUR FIREBASE CONFIG - READY TO USE
        const firebaseConfig = {
            apiKey: "AIzaSyA72Yo_YGqno9PX25p3yQBvyflcaM-NqEM",
            authDomain: "x-bet-prod-jd.firebaseapp.com",
            projectId: "x-bet-prod-jd",
            storageBucket: "x-bet-prod-jd.firebasestorage.app",
            messagingSenderId: "499334334535",
            appId: "1:499334334535:web:bebc1bf817e24d9e3c4962",
            measurementId: "G-PTV4XMYQ6P"
        };

        // Firebase variables
        let db;
        let realUsers = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeFirebase();
            setupEventListeners();
        });

        // Initialize Firebase
        function initializeFirebase() {
            try {
                // Initialize Firebase with YOUR config
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                showNotification('‚úÖ Successfully connected to X-BET Firebase!', 'success');
                loadUsersFromFirebase();
                
            } catch (error) {
                console.error('Firebase initialization error:', error);
                showNotification('‚ùå Firebase connection failed: ' + error.message, 'error');
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            document.getElementById('refresh-users').addEventListener('click', loadUsersFromFirebase);
            document.getElementById('search-users').addEventListener('input', filterUsers);
        }

        // Load users from Firebase
        async function loadUsersFromFirebase() {
            try {
                const loadingMessage = document.getElementById('loading-message');
                loadingMessage.textContent = 'Loading users from your X-BET database...';
                
                console.log('üîç Loading users from Firebase...');
                
                // Try different collection names
                const collections = ['users', 'user', 'players', 'accounts', 'members'];
                let usersFound = false;
                
                for (const collectionName of collections) {
                    try {
                        console.log(`Trying collection: ${collectionName}`);
                        const usersSnapshot = await db.collection(collectionName).get();
                        
                        if (!usersSnapshot.empty) {
                            console.log(`‚úÖ Found collection: ${collectionName} with ${usersSnapshot.size} users`);
                            realUsers = [];
                            
                            usersSnapshot.forEach(doc => {
                                const userData = doc.data();
                                realUsers.push({
                                    id: doc.id,
                                    ...userData
                                });
                            });
                            
                            renderUsers(realUsers);
                            showNotification(`‚úÖ Loaded ${realUsers.length} users from ${collectionName}`, 'success');
                            usersFound = true;
                            break;
                        }
                    } catch (error) {
                        console.log(`Collection ${collectionName} not accessible:`, error);
                    }
                }
                
                if (!usersFound) {
                    showNotification('‚ùå No user collections found. Please check your Firebase database structure.', 'error');
                }
                
            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('‚ùå Error loading users: ' + error.message, 'error');
            }
        }

        // Render users in the table
        function renderUsers(users) {
            const usersContainer = document.getElementById('users-container');
            const loadingMessage = document.getElementById('loading-message');
            
            loadingMessage.style.display = 'none';
            usersContainer.innerHTML = '';
            
            if (users.length === 0) {
                usersContainer.innerHTML = '<div class="loading">No users found in your database</div>';
                updateUserStats(0);
                return;
            }
            
            console.log('üë• Rendering users:', users);
            
            users.forEach(user => {
                const userRow = document.createElement('div');
                userRow.className = 'user-row';
                
                // Handle different field names
                const email = user.email || user.userEmail || 'No email';
                const displayName = user.displayName || user.username || user.name || email.split('@')[0];
                const balance = user.balance || user.walletBalance || user.currentBalance || 0;
                const profit = user.profit || user.totalProfit || user.winnings || 0;
                const status = user.status || (user.isActive !== false ? 'active' : 'inactive');
                const registered = user.createdAt ? 
                    new Date(user.createdAt.seconds * 1000).toLocaleDateString() : 
                    (user.registrationDate || 'N/A');

                userRow.innerHTML = `
                    <div class="user-info-col">
                        <div class="user-name">${displayName}</div>
                        <div class="user-email">${email}</div>
                    </div>
                    <div><strong>$${balance.toFixed(2)}</strong></div>
                    <div>$${profit.toFixed(2)}</div>
                    <div><span class="status-badge status-${status}">${status}</span></div>
                    <div>${registered}</div>
                    <div>
                        <button class="btn btn-primary" onclick="processTransaction('${user.id}', '${email}')">
                            Transfer
                        </button>
                    </div>
                `;
                
                usersContainer.appendChild(userRow);
            });

            updateUserStats(users.length);
        }

        // Update user statistics
        function updateUserStats(total) {
            document.getElementById('total-users').textContent = total;
            document.getElementById('active-users').textContent = realUsers.filter(user => 
                user.status === 'active' || user.isActive !== false
            ).length;
        }

        // Filter users based on search
        function filterUsers() {
            const searchTerm = this.value.toLowerCase();
            if (!searchTerm) {
                renderUsers(realUsers);
                return;
            }

            const filteredUsers = realUsers.filter(user => {
                const email = (user.email || user.userEmail || '').toLowerCase();
                const displayName = (user.displayName || user.username || user.name || '').toLowerCase();
                return email.includes(searchTerm) || displayName.includes(searchTerm);
            });

            renderUsers(filteredUsers);
        }

        // Process transaction
        function processTransaction(userId, userEmail) {
            const amount = prompt(`Enter amount to transfer to ${userEmail}:`);
            if (amount && !isNaN(amount)) {
                showNotification(`‚úÖ Transferring $${amount} to ${userEmail}`, 'success');
                // Add your actual transaction logic here
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Debug function
        window.debugFirebase = function() {
            console.log('Firebase Config:', firebaseConfig);
            console.log('Firebase App:', firebase.apps);
            console.log('Firestore DB:', db);
            console.log('Loaded Users:', realUsers);
        };
    </script>
</body>
</html>
